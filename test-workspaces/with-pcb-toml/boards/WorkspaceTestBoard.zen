"""
Test board demonstrating workspace-relative paths (// syntax).
This board uses modules referenced via // paths to test that workspace
root detection works correctly with pcb.toml files.
"""

load("@stdlib:v0.2.2/interfaces.zen", "Ground", "Power", "Spi")

# Use workspace-relative paths for modules - this tests // path resolution
PowerSupplyModule = Module("//modules/PowerSupplyModule.zen")
LedIndicatorModule = Module("//modules/LedIndicatorModule.zen")

Flash = Module("@kicad/Memory_Flash/W25Q128JVE.zen")

add_property("layout_path", "build/WorkspaceTestBoard")

# Power rails
vcc_3v3 = Power("VCC_3V3")
gnd = Ground("GND")

# Internal power domains
filtered_vcc = Power("FILTERED_VCC")

# Power supply with filtering (uses // path)
PowerSupplyModule(
    name="PS1",
    filter_cap_value="100nF",
    pullup_value="10kOhm",
    VCC=vcc_3v3,
    GND=gnd,
    FILTERED_VCC=filtered_vcc.NET,
)

# Status indicator (also uses // path)
LedIndicatorModule(
    name="STATUS1",
    led_color="green",
    current_limit_value="220Ohm",
    VCC=filtered_vcc,
    GND=gnd,
    ENABLE=gnd.NET,  # Always on
)

Flash(
    name="FLASH",
    VCC=vcc_3v3.NET,
    GND=gnd.NET,
    HOLD=Net(),
    spi=Spi(),
    properties = {
        "embed": "true",
    },
)

# pcb:sch FILTERED_VCC_VCC.1 x=1134.3800 y=37.1000 rot=0
# pcb:sch FLASH x=203.2000 y=-127.0000 rot=0
# pcb:sch GND_GND.1 x=1230.9000 y=341.9000 rot=0
# pcb:sch PS1.C_FILTER.C x=1299.4800 y=-51.8000 rot=0
# pcb:sch PS1.R_PULLUP.R x=1233.4400 y=-51.8000 rot=0
# pcb:sch STATUS1.D_STATUS.LED x=1218.2000 y=235.2200 rot=270
# pcb:sch STATUS1.R_LIMIT.R x=1233.4400 y=113.3000 rot=0
# pcb:sch VCC_3V3_VCC.1 x=1235.9800 y=-140.7000 rot=0
